<!DOCTYPE html>
<html lang="vi">
<head>
<title>ZET Tapper - Kiếm ZET trên TON</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<style>
body { background: #f0f0f0; text-align: center; font-family: Arial; color: #333; }
#tap-button { font-size: 50px; padding: 20px; background: #4CAF50; color: white; border: none; border-radius: 10px; margin: 20px; }
#score { font-size: 40px; }
button { padding: 10px 20px; margin: 10px; background: #2196F3; color: white; border: none; border-radius: 5px; }
#tasks { margin: 20px; }
img { max-width: 100px; margin: 10px; }
</style>
</head>
<body>
<img src="https://ecodig.online/zet.png" alt="ZET Network Logo">
<h1>ZET Network Tapper</h1>
<p>Tap để kiếm ZET Coins! Hoàn thành nhiệm vụ để kiếm thêm. Kết nối TON Wallet để claim.</p>
<button id="tap-button">Tap Here! (+1 ZET)</button>
<p>Điểm: <span id="score">0</span> ZET</p>

<div id="tasks">
<h2>Nhiệm Vụ</h2>
<button id="daily-checkin">Check-in Hàng Ngày (+100 ZET)</button>
<button id="invite-friend">Mời Bạn Bè (+200 ZET)</button>
<button id="view-ad">Xem Quảng Cáo (+50 ZET)</button>
<button id="follow-x">Follow X (+3 ZET)</button>
</div>

<div id="connect-ton"></div>
<button id="claim-rewards">Claim ZET qua TON</button>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
manifestUrl: 'https://zet-tapper.vercel.app/tonconnect-manifest.json',
buttonRootId: 'connect-ton'
});

let score = 0;
let lastCheckin = '';
const ZET_TOKEN_ADDRESS = 'YOUR_ZET_TOKEN_ADDRESS'; // Thay bằng contract ZET trên TON
const scoreDisplay = document.getElementById('score');
const tapButton = document.getElementById('tap-button');
const dailyButton = document.getElementById('daily-checkin');
const inviteButton = document.getElementById('invite-friend');
const adButton = document.getElementById('view-ad');
const followXButton = document.getElementById('follow-x');
const claimButton = document.getElementById('claim-rewards');

// Load điểm và check-in từ Telegram Cloud Storage
tg.CloudStorage.getItems(['zet_score', 'zet_last_checkin'], (err, values) => {
if (values.zet_score) score = parseInt(values.zet_score);
if (values.zet_last_checkin) lastCheckin = values.zet_last_checkin;
updateScore();
});

function updateScore() {
scoreDisplay.innerText = score;
tg.MainButton.setText(`Lưu & Claim: ${score} ZET`);
tg.MainButton.show();
}

tapButton.addEventListener('click', () => {
score += 1;
updateScore();
tg.HapticFeedback.impactOccurred('light');
saveScore();
});

dailyButton.addEventListener('click', () => {
const today = new Date().toISOString().split('T')[0];
if (lastCheckin !== today) {
score += 100;
lastCheckin = today;
updateScore();
saveScore();
tg.CloudStorage.setItem('zet_last_checkin', lastCheckin);
alert('Check-in thành công! +100 ZET');
} else {
alert('Bạn đã check-in hôm nay!');
}
});

inviteButton.addEventListener('click', () => {
tg.shareUrl(`https://t.me/zet_network_game_bot?start=ref_${tg.initDataUnsafe.user.id}`, 'Tham gia ZET Tapper và kiếm ZET!');
score += 200;
updateScore();
saveScore();
});

adButton.addEventListener('click', () => {
alert('Xem quảng cáo hoàn tất! +50 ZET');
score += 50;
updateScore();
saveScore();
});

followXButton.addEventListener('click', () => {
window.open('https://x.com/zetnetwork_app');
score += 3;
updateScore();
saveScore();
});

claimButton.addEventListener('click', async () => {
if (!tonConnectUI.connected) {
alert('Kết nối TON Wallet trước!');
return;
}
try {
const transaction = {
validUntil: Math.floor(Date.now() / 1000) + 60,
messages: [{
address: ZET_TOKEN_ADDRESS,
amount: (score * 1e9).toString(), // Giả sử 1 ZET = 10^9 nanoTON
payload: btoa(JSON.stringify({ action: 'claim', amount: score }))
}]
};
const result = await tonConnectUI.sendTransaction(transaction);
alert(`Claimed ${score} ZET qua TON Wallet! Tx: ${result.boc}`);
score = 0;
updateScore();
saveScore();
} catch (e) {
alert('Claim thất bại: ' + e.message);
}
});

tg.MainButton.onClick(() => {
tg.sendData(JSON.stringify({ score }));
});

function saveScore() {
tg.CloudStorage.setItem('zet_score', score.toString());
}
</script>
</body>
</html>
